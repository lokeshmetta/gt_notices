<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Column Mapper</title>
    <style>
        body {
            font-family: 'Gautami', sans-serif;
        }

        /* Styles for both the webpage and print */
        .khata-header {
            margin-bottom: 5px;
            display: none;
        }

        .telugu-header-print {
            display: none;
        }

        .khata-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        .khata-table,
        .khata-table th,
        .khata-table td {
            border: 1px solid black;
        }

        /* Add padding to all table cells */
        .khata-table td,
        .khata-table th {
            padding: 5px;
            text-align: left;
            /* Align text to the left */
            vertical-align: top;
            /* Key Change: Align content to the top */
        }

        @media print {
            .no-print {
                display: none;
            }

            @page {
                margin: 5mm;
                border: 1px solid black;
            }

            body {
                margin: 0;
            }

            body::after {
                content: 'Place';
                position: fixed;
                bottom: 10px;
                left: 10px;
                font-size: 12px;
            }

            .khata-group {
                page-break-after: always;
                margin-bottom: 0px;
                position: relative;
            }

            .khata-group:last-child {
                page-break-after: auto;
            }

            .telugu-header-print {
                display: block;
                text-align: left;
                margin-bottom: 0px;
                width: 100%;
            }

            .telugu-header-print h3 {
                margin: 0;
                text-align: center;
                font-weight: bold;
            }

            .telugu-header-print p {
                text-align: left;
                padding-left: 10px;
                padding-right: 10px;
                font-weight: normal;
            }

            .signature-column {
                width: 150px;
            }
        }

        /* Non-print styles for the table */
        #previewTable {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            /* Add some spacing between tables */
        }

        #previewTable th,
        #previewTable td {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
            /* Align text to the left */
            vertical-align: top;
            /* Key Change: Align content to the top */
        }

        /* Add styles for the mapping table to make it aligned */
        #mappingTable {
            width: auto;
            /* Adjust width to content */
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid black;

        }

        #mappingTable th,
        #mappingTable td {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
            vertical-align: middle;
            white-space: nowrap;
            /* Prevents text wrapping */
        }

        #mappingTable select {
            width: 100%;
            box-sizing: border-box;
            /* Include padding in element width */
        }

        #teluguHeader {
            text-align: center;
            margin-bottom: 20px;
            display: block;
        }

        #teluguHeader h3 {
            margin: 0;
            text-align: center;
            font-weight: bold;
        }

        #teluguHeader p {
            text-align: left;
            font-weight: normal;
        }

        /* Add a container for better alignment of the select column */
        .select-container {
            width: 150px;
            /* Adjust as needed */
            display: inline-block;
        }

        #previewContainer {
            overflow-x: auto;
            /* Enable horizontal scrolling if needed */
        }
    </style>
</head>

<body>
    <h2>Upload CSV and Map Columns</h2>
    <input type="file" id="csvFile" accept=".csv" class="no-print">
    <br><br>
    <table id="mappingTable" border="1" style="display:none;">
        <thead>
            <tr>
                <th>CSV Column</th>
                <th>Map To</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <br>
    <button id="submitMapping" style="display:none;" class="no-print">Submit Mapping</button>
    <br><br>
    <h3>Mapped Data Preview</h3>
    <div id="teluguHeader">
        <h3>ఫారం-19</h3>
        <h3>భూ యాజమాన్య దారులకు నోటీసు</h3>
        <h3>భూ నిజ నిర్దారణ కొరకు</h3>
        <p>
            1) సర్వే సహాయక సంచాలకులు Assistant Director వారి నోటిఫికేషన్ నెం. 6(i), అనుసరించి, శ్రీకాకుళం జిల్లా,
            కోటబొమ్మాళి మండలం, నారాయణవలస గ్రామములో సీమానిర్ణయం (demarcation) మరియు సర్వే పనులు
            .............................. తేదీన 8:30 AM గం.ని.లకు ప్రారంభిచబడును అని తెలియజేయడమైనది.<br>
            2) సర్వే మరియు సరిహద్దుల చట్టం, 1923లోని నియమ నిబంధనలు అనుసరించి సర్వే సమయం నందు ఈ క్రింది షెడ్యూల్ లోని భూ
            యజమానులు భూమి వద్ద హాజరై మీ పొలము యొక్క సరిహద్దులను చూపించి, తగిన సమాచారం మరియు అవసరమైన సహాయ సహకారములు
            అందించవలసినదిగా తెలియజేయడమైనది.
        </p>
    </div>
    <div id="previewContainer">
    </div>
    <br>
    <button onclick="window.print();" class="no-print">Print</button>

    <script>
        let csvData = [];
        const teluguHeaderContent = `
        <h3>ఫారం-19</h3>
        <h3>భూ యాజమాన్య దారులకు నోటీసు</h3>
        <h3>భూ నిజ నిర్దారణ కొరకు</h3>
        <p>
            1) సర్వే సహాయక సంచాలకులు Assistant Director వారి నోటిఫికేషన్ నెం. 6(i), అనుసరించి, శ్రీకాకుళం జిల్లా,
            కోటబొమ్మాళి మండలం, నారాయణవలస గ్రామములో సీమానిర్ణయం (demarcation) మరియు సర్వే పనులు
            .............................. తేదీన 8:30 AM గం.ని.లకు ప్రారంభిచబడును అని తెలియజేయడమైనది.<br>
            2) సర్వే మరియు సరిహద్దుల చట్టం, 1923లోని నియమ నిబంధనలు అనుసరించి సర్వే సమయం నందు ఈ క్రింది షెడ్యూల్ లోని భూ
            యజమానులు భూమి వద్ద హాజరై మీ పొలము యొక్క సరిహద్దులను చూపించి, తగిన సమాచారం మరియు అవసరమైన సహాయ సహకారములు
            అందించవలసినదిగా తెలియజేయడమైనది.
        </p>
    `;

        document.getElementById('csvFile').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const rows = e.target.result.split('\n').map(row => row.split(','));
                csvData = rows.slice(1);
                const headers = rows[0];

                const mappingFields = ['Survey No', 'Khata No', 'Pattadar Name', 'Relation Name', 'Mobile Number'];
                const tableBody = document.querySelector('#mappingTable tbody');
                tableBody.innerHTML = '';

                headers.forEach(header => {
                    const row = document.createElement('tr');

                    const headerCell = document.createElement('td');
                    headerCell.textContent = header;
                    row.appendChild(headerCell);

                    const selectCell = document.createElement('td');
                    selectCell.classList.add('select-container')
                    const select = document.createElement('select');
                    select.innerHTML = `<option value="">-- Select --</option>` +
                        mappingFields.map(field => `<option value="${field}">${field}</option>`).join('');
                    selectCell.appendChild(select);
                    row.appendChild(selectCell);

                    tableBody.appendChild(row);
                });

                document.getElementById('mappingTable').style.display = 'table';
                document.getElementById('submitMapping').style.display = 'block';
            };

            reader.readAsText(file);
        });

        document.getElementById('submitMapping').addEventListener('click', function () {
            const selects = document.querySelectorAll('#mappingTable select');
            const mapping = {};
            let khataIndex = -1;

            selects.forEach((select, index) => {
                if (select.value) {
                    mapping[select.value] = index;
                    if (select.value === 'Khata No') {
                        khataIndex = index;
                    }
                }
            });

            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = '';

            if (khataIndex === -1) {
                const table = createTable(mapping, csvData, 'All Data');
                previewContainer.appendChild(table);

            } else {
                const khataGroups = {};
                csvData.forEach(row => {
                    const khataNo = row[khataIndex];
                    if (!khataGroups[khataNo]) {
                        khataGroups[khataNo] = [];
                    }
                    khataGroups[khataNo].push(row);
                });

                for (const khataNo in khataGroups) {
                    const table = createTable(mapping, khataGroups[khataNo], khataNo);
                    previewContainer.appendChild(table);
                }
            }

            document.getElementById('teluguHeader').style.display = 'block';
        });

        function createTable(mapping, data, headerText) {
            const khataGroup = document.createElement('div');
            khataGroup.classList.add('khata-group');
            const teluguHeader = document.createElement('div');
            teluguHeader.classList.add('telugu-header-print');
            teluguHeader.innerHTML = teluguHeaderContent;
            khataGroup.appendChild(teluguHeader);

            const header = document.createElement('div');
            header.classList.add('khata-header');
            header.textContent = headerText;
            khataGroup.appendChild(header);

            const table = document.createElement('table');
            table.classList.add('khata-table');
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            Object.keys(mapping).forEach(field => {
                const th = document.createElement('th');
                th.textContent = field;
                headerRow.appendChild(th);
            });
            const signatureTh = document.createElement('th');
            signatureTh.textContent = 'Signature';
            signatureTh.classList.add('signature-column');
            headerRow.appendChild(signatureTh);

            thead.appendChild(headerRow);
            table.appendChild(thead);
            const tbody = document.createElement('tbody');

            data.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(mapping).forEach(index => {
                    const td = document.createElement('td');
                    td.textContent = row[index] || '';
                    tr.appendChild(td);
                });
                const signatureTd = document.createElement('td');
                signatureTd.classList.add('signature-column');
                tr.appendChild(signatureTd);

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            khataGroup.appendChild(table);
            return khataGroup;
        }
    </script>
</body>

</html>