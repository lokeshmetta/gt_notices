<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Column Mapper</title>
    <style>
        body {
            font-family: 'Gautami', sans-serif;
            margin: 20px;
            /* Reset default body margin */
            position: relative;
            /* To position the footer */
            min-height: 100vh;
            /* Ensure body takes full viewport height */
        }

        /* Styles for both the webpage and print */
        .khata-header {
            margin-bottom: 5px;
            display: none;
        }

        .telugu-header-print {
            display: none;
        }

        .khata-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            table-layout: fixed;
            /* Key Change: Fixed table layout */
        }

        .khata-table,
        .khata-table th,
        .khata-table td {
            border: 1px solid black;
        }

        /* Add padding to all table cells */
        .khata-table td,
        .khata-table th {
            padding: 5px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            /* Key Change: Allow text wrapping */
            overflow: hidden;
            /* Hide any overflow */
        }

        .khata-table th {
            text-align: center;
        }

        /* New Footer Styles (Moved outside @media print) */
        .page-footer {
            /* position: fixed; Removed fixed*/
            bottom: 10px;
            left: 10px;
            width: calc(100% - 20px);
            /* Full width minus left/right padding */
            font-size: 12px;
            display: flex;
            flex-direction: column;
            /* margin-top: 20px; Removed for proper alignment*/
            padding-top: 50px;
            /* Added padding-top for space*/
        }

        .footer-row {
            display: flex;
            width: 100%;
            justify-content: space-between;
        }

        .left-column {
            display: flex;
            flex-direction: column;
        }

        .right-column {
            text-align: right;
            padding-right: 60px;
        }

        .body-footer-text {
            text-align: left;
            margin: 0;
        }

        @media print {
            .no-print {
                display: none;
            }

            @page {
                margin: 5mm;
                border: 1px solid black;
            }

            body {
                margin: 0;
                /* Remove body margin in print */
                min-height: auto;
                /*position: relative; Remove this as footer is fixed  */
                /* Add position relative to body */
            }

            .khata-group {
                page-break-after: always;
                margin-bottom: 0px;
                position: relative;
                display: flex;
                /* Added to make flex work*/
                flex-direction: column;
                /* Added to make flex work*/
                justify-content: space-between;
                /* Added to make flex work*/

            }

            .khata-group .page-footer {
                position: relative;
                margin-top: auto;
                /* Push footer to bottom */
            }

            .khata-group:last-child {
                page-break-after: auto;
            }

            .telugu-header-print {
                display: block;
                text-align: left;
                margin-bottom: 0px;
                width: 100%;
            }

            .telugu-header-print h3 {
                margin-top: 10px;
                text-align: center;
                font-weight: bold;
            }

            .telugu-header-print p {
                text-align: left;
                padding-left: 10px;
                padding-right: 10px;
                font-weight: normal;
            }

            .signature-column {
                width: 150px;
            }

            .page-footer {
                position: relative;
                bottom: auto;
            }


        }

        /* Non-print styles for the table */
        #previewTable {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        #previewTable th,
        #previewTable td {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
            vertical-align: top;
        }

        /* Add styles for the mapping table to make it aligned */
        #mappingTable {
            width: auto;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid black;
        }

        #mappingTable th,
        #mappingTable td {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
            vertical-align: middle;
            white-space: nowrap;
        }

        #mappingTable select {
            width: 100%;
            box-sizing: border-box;
        }

        #teluguHeader {
            text-align: center;
            margin-bottom: 20px;
            display: block;
        }

        #teluguHeader h3 {
            margin: 0;
            text-align: center;
            font-weight: bold;
        }

        #teluguHeader p {
            text-align: left;
            font-weight: normal;
        }

        /* Add a container for better alignment of the select column */
        .select-container {
            width: 150px;
            display: inline-block;
        }

        #previewContainer {
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h2>Upload CSV and Map Columns</h2>
    <input type="file" id="csvFile" accept=".csv" class="no-print">
    <br><br>
    <table id="mappingTable" border="1" style="display:none;">
        <thead>
            <tr>
                <th>Map To</th>
                <th>CSV Column</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <br>
    <button id="submitMapping" style="display:none;" class="no-print">Submit Mapping</button>
    <br><br>
    <h3>Mapped Data Preview</h3>
    <div id="teluguHeader">
        <h3>ఫారం-19</h3>
        <h3>భూ యాజమాన్య దారులకు నోటీసు</h3>
        <h3>భూ నిజ నిర్దారణ కొరకు</h3>
        <p>
            1) సర్వే సహాయక సంచాలకులు Assistant Director వారి నోటిఫికేషన్ నెం. 6(i), అనుసరించి, శ్రీకాకుళం జిల్లా,
            కోటబొమ్మాళి మండలం, నారాయణవలస గ్రామములో సీమానిర్ణయం (demarcation) మరియు సర్వే పనులు
            .............................. తేదీన 8:30 AM గం.ని.లకు ప్రారంభిచబడును అని తెలియజేయడమైనది.<br>
            2) సర్వే మరియు సరిహద్దుల చట్టం, 1923లోని నియమ నిబంధనలు అనుసరించి సర్వే సమయం నందు ఈ క్రింది షెడ్యూల్ లోని భూ
            యజమానులు భూమి వద్ద హాజరై మీ పొలము యొక్క సరిహద్దులను చూపించి, తగిన సమాచారం మరియు అవసరమైన సహాయ సహకారములు
            అందించవలసినదిగా తెలియజేయడమైనది.
        </p>
    </div>
    <div id="previewContainer">
    </div>
    <br>
    <button onclick="window.print();" class="no-print">Print</button>


    <script>
        let csvData = [];
        let headers = []; // Declare headers here
        const teluguHeaderContent = `
        <h3>ఫారం-19<br>
        భూ యాజమాన్య దారులకు నోటీసు<br>
        భూ నిజ నిర్దారణ కొరకు</h3>
        <p>
            1) సర్వే సహాయక సంచాలకులు Assistant Director వారి నోటిఫికేషన్ నెం. 6(i), అనుసరించి, శ్రీకాకుళం జిల్లా,
            కోటబొమ్మాళి మండలం, నారాయణవలస గ్రామములో సీమానిర్ణయం (demarcation) మరియు సర్వే పనులు
            .............................. తేదీన 8:30 AM గం.ని.లకు ప్రారంభిచబడును అని తెలియజేయడమైనది.<br>
            2) సర్వే మరియు సరిహద్దుల చట్టం, 1923లోని నియమ నిబంధనలు అనుసరించి సర్వే సమయం నందు ఈ క్రింది షెడ్యూల్ లోని భూ
            యజమానులు భూమి వద్ద హాజరై మీ పొలము యొక్క సరిహద్దులను చూపించి, తగిన సమాచారం మరియు అవసరమైన సహాయ సహకారములు
            అందించవలసినదిగా తెలియజేయడమైనది.
        </p>
    `;

        const mappingFields = [
            { en: 'Survey No', te: 'సర్వే నెం' },
            { en: 'Khata No', te: 'ఖాతా సంఖ్య' },
            { en: 'Pattadar Name', te: 'భూ యజమాని పేరు' },
            { en: 'Relation Name', te: 'భర్త/తండ్రి పేరు' },
            { en: 'Mobile Number', te: 'మొబైల్ నెంబరు' }
        ];
        const teluguMappingFields = mappingFields.map(field => field.te);
        // Add content to body::after
        const placeDateContent = `<div class="footer-row">
                <div class="left-column">
                    <p class="body-footer-text">స్తలం: </p>
                    <p class="body-footer-text">తేది: </p>
                </div>
                <div class="right-column">
                    <p class="body-footer-text">గ్రామ సర్వేయర్ సంతకం</p>
                </div>
            </div>`;
        document.getElementById('csvFile').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const rows = e.target.result.split('\n').map(row => row.split(','));
                csvData = rows.slice(1);
                headers = rows[0]; // Assign headers here!

                const tableBody = document.querySelector('#mappingTable tbody');
                tableBody.innerHTML = '';

                mappingFields.forEach(field => {
                    const row = document.createElement('tr');

                    const fieldCell = document.createElement('td');
                    fieldCell.textContent = field.en; // Use English name for mapping
                    row.appendChild(fieldCell);

                    const selectCell = document.createElement('td');
                    selectCell.classList.add('select-container')
                    const select = document.createElement('select');
                    select.innerHTML = `<option value="">-- Select --</option>` +
                        headers.map(header => `<option value="${header}">${header}</option>`).join('');
                    selectCell.appendChild(select);
                    row.appendChild(selectCell);

                    tableBody.appendChild(row);
                });


                document.getElementById('mappingTable').style.display = 'table';
                document.getElementById('submitMapping').style.display = 'block';
            };

            reader.readAsText(file);
        });

        document.getElementById('submitMapping').addEventListener('click', function () {
            const selects = document.querySelectorAll('#mappingTable select');
            const mapping = {};
            let khataIndex = -1;

            selects.forEach((select, index) => {
                if (select.value) {
                    mapping[mappingFields[index].en] = select.value; // Map field to CSV header

                }
            });

            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = '';

            if (mapping["Khata No"]) {
                const khataGroups = {};
                csvData.forEach(row => {
                    const khataNo = row[headers.indexOf(mapping["Khata No"])];
                    if (!khataGroups[khataNo]) {
                        khataGroups[khataNo] = [];
                    }
                    khataGroups[khataNo].push(row);
                });

                for (const khataNo in khataGroups) {
                    const table = createTable(mapping, khataGroups[khataNo], khataNo);
                    const khataGroup = table.parentElement;
                    previewContainer.appendChild(khataGroup);
                    const footer = document.createElement('div');
                    footer.classList.add('page-footer');
                    footer.innerHTML = placeDateContent;
                    khataGroup.appendChild(footer);
                }
            } else {
                const table = createTable(mapping, csvData, 'All Data');
                const khataGroup = table.parentElement;
                previewContainer.appendChild(khataGroup);
                const footer = document.createElement('div');
                footer.classList.add('page-footer');
                footer.innerHTML = placeDateContent;
                khataGroup.appendChild(footer);

            }

            document.getElementById('teluguHeader').style.display = 'block';
        });

        function createTable(mapping, data, headerText) {
            const khataGroup = document.createElement('div');
            khataGroup.classList.add('khata-group');
            const teluguHeader = document.createElement('div');
            teluguHeader.classList.add('telugu-header-print');
            teluguHeader.innerHTML = teluguHeaderContent;
            khataGroup.appendChild(teluguHeader);

            const header = document.createElement('div');
            header.classList.add('khata-header');
            header.textContent = headerText;
            khataGroup.appendChild(header);

            const table = document.createElement('table');
            table.classList.add('khata-table');
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            teluguMappingFields.forEach(field => {
                const th = document.createElement('th');
                th.textContent = field;
                headerRow.appendChild(th);
            });

            const signatureTh = document.createElement('th');
            signatureTh.textContent = 'సంతకం';
            signatureTh.classList.add('signature-column');
            headerRow.appendChild(signatureTh);

            thead.appendChild(headerRow);
            table.appendChild(thead);
            const tbody = document.createElement('tbody');

            data.forEach(row => {
                const tr = document.createElement('tr');
                mappingFields.forEach(field => {
                    const td = document.createElement('td');
                    const csvHeader = mapping[field.en];
                    if (csvHeader) {
                        const index = headers.indexOf(csvHeader);
                        if (index >= 0) {
                            td.textContent = row[index] || ''; // Get value from row using mapped CSV index
                        }
                    }

                    tr.appendChild(td);
                });

                const signatureTd = document.createElement('td');
                signatureTd.classList.add('signature-column');
                tr.appendChild(signatureTd);

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);

            khataGroup.appendChild(table);
            return table;
        }




    </script>
</body>

</html>